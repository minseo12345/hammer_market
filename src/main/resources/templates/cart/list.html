<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Item List</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container mt-5">
    <h2>Item List</h2>
    <div id="itemList"></div>
</div>

<script>
    const request = indexedDB.open("shoppingDB", 1);

    request.onupgradeneeded = function(event) {
        const db = event.target.result;
        if (!db.objectStoreNames.contains("cart")) {
            db.createObjectStore("cart", { keyPath: "itemId" }); // Using itemId as the key
        }
    };

    request.onsuccess = function(event) {
        const db = event.target.result;
        const itemList = [
            //더미 데이터
            { itemId: "1", name: "Apple", price: 1 },
            { itemId: "2", name: "Banana", price: 0.5 },
            { itemId: "3", name: "Cherry", price: 2 },
        ];

        const ul = document.getElementById("itemList");

        itemList.forEach((item) => {
            const li = document.createElement("li");
            li.textContent = `${item.name} - $${item.price}`;
            const button = document.createElement("button");
            button.textContent = "Add to Cart";
            button.onclick = function () {
                addToCart(db, item);
            };
            li.appendChild(button);
            ul.appendChild(li);
        });
    };

    function addToCart(db, item) {
        const transaction = db.transaction("cart", "readwrite");
        const store = transaction.objectStore("cart");

        store.add(item).onsuccess = () => {
            alert(`${item.name} added to cart.`);
        };

        store.onerror = (e) => {
            console.error("Error adding item to cart:", e.target.error);
        };
    }
</script>
</body>
</html>
